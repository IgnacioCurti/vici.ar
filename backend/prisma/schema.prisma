generator client {
  provider = "prisma-client"
  output   = "../prisma/generated"
}

datasource db {
  provider = "postgresql"
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model User {
  user_id             BigInt               @id @default(autoincrement())
  username            String               @unique
  created_at          DateTime             @default(now())
  description         String?
  displayname         String?
  email               String               @unique
  password            String
  verification_code   String
  email_verified      Boolean              @default(false)
  hostedEvents        Events[]             @relation("EventHost")
  eventParticipations EventsUsers[]
  availableTimes      FreeTime[]
  receivedFriendships UsersRelationships[] @relation("ReceivedFriendRequests")
  sentFriendshps      UsersRelationships[] @relation("SentFriendRequests")

  @@index([user_id])
  @@index([username])
  @@index([email])
  @@map("Users")
}

model Events {
  event_id          BigInt       @id @default(autoincrement())
  start_time        DateTime
  end_time          DateTime
  description       String
  game_id           String       @unique @db.Uuid
  host_id           BigInt
  schedule_at       DateTime     @default(now())
  host              User         @relation("EventHost", fields: [host_id], references: [user_id], onDelete: Cascade)
  eventParticipants EventsUsers?
}

model EventsUsers {
  event_id BigInt          @id @default(autoincrement())
  user_id  BigInt
  status   EventUserStatus @default(PENDING)
  event    Events          @relation(fields: [event_id], references: [event_id], onDelete: Cascade)
  user     User            @relation(fields: [user_id], references: [user_id], onDelete: Cascade)

  @@index([event_id])
  @@index([user_id])
}

model FreeTime {
  free_time_id  BigInt    @id @default(autoincrement())
  user_id       BigInt
  day_of_week   Int?
  specific_date DateTime? @db.Date
  end_time      DateTime  @db.Time(6)
  is_recurrent  Boolean
  is_active     Boolean   @default(true)
  valid_until   DateTime? @db.Date
  start_time    DateTime  @db.Time(6)
  user          User      @relation(fields: [user_id], references: [user_id], onDelete: Cascade)

  @@index([user_id])
  @@index([free_time_id])
  @@index([specific_date])
}

model UsersRelationships {
  relationship_id  BigInt             @id @default(autoincrement())
  status           RelationshipStatus
  status_timestamp DateTime
  sender_id        BigInt
  receiver_id      BigInt
  receiver         User               @relation("ReceivedFriendRequests", fields: [receiver_id], references: [user_id], onDelete: Cascade)
  sender           User               @relation("SentFriendRequests", fields: [sender_id], references: [user_id], onDelete: Cascade)

  @@index([relationship_id])
  @@index([sender_id])
  @@index([receiver_id])
  @@index([status])
}

enum EventUserStatus {
  PENDING
  ACCEPTED
  DECLINED
  TENTATIVE
}

enum RelationshipStatus {
  PENDING
  ACCEPTED
  BLOCKED
}
